import moment from 'moment';

// https://github.com/kodie/moment-holiday
!function(t){var e=[],r=function(r,n,a){for(var i,s=[],o=0;o<e.length;o++){var h=e[o](r,n);(h||!1===h)&&(i=h)}if(!1===i)return!1;if("string"==typeof i?n=i:i&&(s=i),!t.isMoment(s)&&!s.length&&n.charAt(0).match(/[0-9(]/)){var f=!1,y=n.split("|");y.length>1&&(f=!0),y.length>2&&(y=[y[0],y[1]]);for(o=0;o<y.length;o++){var d=t(r),c=y[o].split("/");if(1===c.length||2===c.length&&"("!==c[1].charAt(0)&&4===c[1].length){var u=y[o];o=-1,y=[];for(var v=1;v<13;v++)y.push(v+"/"+u)}else if(c.length>2&&d.year(parseInt(c[2])),d.month(parseInt(c[0])-1),"("===c[1].charAt(0)){var g=c[1].slice(1,-1).split(","),p=parseInt(g[0]),O=parseInt(g[1]),b=t(d).startOf("month"),w=t(d).endOf("month").diff(b,"days")+1,k=[];if(g[1]&&"["===g[1].charAt(0)){var j=!0;(O=parseInt(g[1].slice(1,-1)))<0&&(j=!1,O=parseInt(g[1].slice(2,-1))),b=t(d).date(O);for(var m=0;m<7;m++){if(b.day()===p){s.push(t(b));break}j?b.add(1,"day"):b.subtract(1,"day")}continue}for(var _=0;_<w;_++)b.day()===p&&k.push(t(b)),b.add(1,"day");if(!O){s=s.concat(k);continue}d=O<0?k[k.length+O]:k[O-1],s.push(d)}else s.push(d.date(c[1]))}if(f&&s.length>1){var P=s[1].diff(s[0],"days");if(P>1){var x=t(s[0]);s=[s[0]];for(o=0;o<P;o++)x.add(1,"day"),s.push(t(x))}}}s=l(s);for(o=0;o<s.length;o++)t.isMoment(s[o])?(a&&(0===s[o].day()&&(s[o]=s[o].add(1,"day")),6===s[o].day()&&(s[o]=s[o].subtract(1,"day"))),s[o]=s[o].startOf("day")):delete s[o];return!!s.length&&(1===s.length?s[0]:s)},n=function(t,e){var r=[];e=l(e);for(var n=0;n<e.length;n++){var a=t.match(new RegExp(e[n],"gi"));a&&(r=r.concat(a))}return r},a=function(e,a,i,s,o){var h={},l=[],y={},d=null,c=o||t.holidays.active;if(c.hasOwnProperty(a))l.push(a);else if(d=f(a,c))l.push(d);else{for(var u in c)if(c.hasOwnProperty(u)){if(h[u]=n(a,u.split(/[\s,.-]+/).filter(function(t){return t.length>2})).length,c[u].keywords_n)if(n(a,c[u].keywords_n).length){h[u]=0;continue}if(c[u].keywords_y){var v=n(a,c[u].keywords_y);if(!v||v.length!==c[u].keywords_y.length){h[u]=0;continue}h[u]+=v.length}if(c[u].keywords){var g=n(a,c[u].keywords);if(!g)continue;h[u]+=g.length}}for(var p in h)h[p]&&h.hasOwnProperty(p)&&(l.length&&h[p]!==h[l[0]]?h[p]>h[l[0]]&&(l=[p]):l.push(p))}if(!l.length)return!1;if(!1===s)return l;for(var O=0;O<l.length;O++){var b=r(e,c[l[O]].date,i);b&&(y[l[O]]=b)}return!!Object.keys(y).length&&y},i=function(e,r,n,i,s){var o=[];i&&(o={}),r=l(r),s||(s=t.holidays.active);for(var h=0;h<r.length;h++){var f=a(e,r[h],n,i,s);f&&(o=i?y(o,f):o.concat(f))}return o},s=function(e,n){var a=t.holidays.active,i={},s=null;for(var o in a)a.hasOwnProperty(o)&&(s=r(e,a[o].date,n))&&(i[o]=s);return i},o=function(e){var r=e.split("/");return e=r[0].toLowerCase().replace(" ","_"),r.shift(),!!t.holidays[e]&&(r.length?function(e,r){var n=t.holidays[e],a={};if(n)for(var i=0;i<r.length;i++){var s=r[i].toLowerCase(),o=t.holidays[e+"/"+s];for(var h in o={},n)if(n.hasOwnProperty(h)){var l=n[h].regions||[],f=n[h].regions_n||[];l.length&&l.join().toLowerCase().split(),f.length&&f.join().toLowerCase().split(),(!l.length&&!f.length||l.length&&~l.indexOf(s)||f.length&&!~f.indexOf(s))&&(o[h]=n[h])}o&&(a=y(a,o))}return!!Object.keys(a).length&&a}(e,r):t.holidays[e])},h=function(e,r,n,a){r||(r=1);for(var i=s(e,a),o=t(e),h=e.year(),f=[],y=0;y<r;y++)for(var d=t(o);;){var c=!1;if(n?d.add(1,"day"):d.subtract(1,"day"),d.year()!==h&&(i=s(d,a),h=d.year()),!Object.keys(i).length){c=!0;break}for(var u in i)if(i.hasOwnProperty(u)){for(var v=!1,g=l(i[u]),p=0;p<g.length;p++)if(d.isSame(g[p],"day")){f.push(g[p]),o=t(d),v=!0;break}if(v){c=!0;break}}if(c)break}return!!f.length&&(1===f.length?f[0]:f)},l=function(t){return t&&t.constructor!==Array?[t]:t},f=function(t,e){e.constructor===Object&&(e=Object.keys(e));for(var r=0;r<e.length;r++)if(t.toLowerCase()===e[r].toLowerCase())return e[r];return!1},y=function(t,e){return Object.assign({},t,e)};t.fn.holiday=function(e,r){t.holidays.active;var n={},i=!1,o=null;if(e){e.constructor!==Array&&(i=!0,e=[e]);for(var h=0;h<e.length;h++)(o=a(this,e[h],r))&&(n=Object.assign({},n,o))}else n=s(this,r);var l=Object.keys(n);return!!l.length&&(1===l.length&&i?n[l[0]]:n)},t.fn.holidays=function(t,e){return this.holiday(t,e)},t.fn.isHoliday=function(t,e){var r,n,a=[];if(t?(t=l(t),r=this.holiday(t,e),n=!1):(r=s(this,e),n=!0),!r)return!1;for(var i in r)if(r.hasOwnProperty(i))for(var o=l(r[i]),h=0;h<o.length;h++)if(this.isSame(o[h],"day")){if(!n)return!0;a.push(i)}return!!a.length&&(1===a.length?a[0]:a)},t.fn.previousHoliday=function(t,e){return h(this,t,!1,e)},t.fn.previousHolidays=function(t,e){return this.previousHoliday(t,e)},t.fn.nextHoliday=function(t,e){return h(this,t,!0,e)},t.fn.nextHolidays=function(t,e){return this.nextHoliday(t,e)},t.fn.holidaysBetween=function(e,r){e||(e=new Date),e=t(e).subtract(1,"day");for(var n=s(this,r),a=t(this),i=a.year(),o=[],h=0;h<e.diff(this,"days")&&(a.add(1,"day"),a.year()!==i&&(n=s(a,r),i=a.year()),Object.keys(n).length);h++)for(var f in n){for(var y=!1,d=l(n[f]),c=0;c<d.length;c++)if(a.isSame(d[c],"day")){o.push(d[c]),y=!0;break}if(y)break}return!!o.length&&o},t.holidays={active:{},active_last:{}},t.modifyHolidays={set:function(e,r){var n={};if(e.constructor===Array){for(var s=[],h=0;h<e.length;h++){var l=a(this,e[h],null,!1);l&&(s=s.concat(l))}if(s.length)for(var f in n=y(t.holidays.active))n.hasOwnProperty(f)&&(~s.indexOf(f)||delete n[f])}else if("string"==typeof e){var d=o(e);if(d)if(r){var c=i(this,r,!1,!1,d);for(h=0;h<c.length;h++)n[c[h]]=y(d[c[h]])}else n=y(d)}else n=e;return!Object.keys(n).length&&e!==n||Object.is(t.holidays.active,n)||(t.holidays.active_last=y(t.holidays.active),t.holidays.active=n),this},add:function(e,r){if("string"==typeof e){var n=o(e);if(e={},n)if(r)for(var a=i(this,r,!1,!1,n),s=0;s<a.length;s++)e[a[s]]=y(n[a[s]]);else e=n}return Object.keys(e).length&&(t.holidays.active_last=y(t.holidays.active),t.holidays.active=y(t.holidays.active,e)),this},remove:function(e){e=l(e);var r=i(this,e,!1,!1),n=y(t.holidays.active);if(r)for(var a=0;a<r.length;a++)delete n[r[a]];return Object.is(t.holidays.active,n)||(t.holidays.active_last=y(t.holidays.active),t.holidays.active=n),this},undo:function(){var e=y(t.holidays.active);return t.holidays.active=y(t.holidays.active_last),t.holidays.active_last=e,this},load:function(t){t=l(t);for(var e=0;e<t.length;e++)o(t[e]);return this},extendParser:function(t){return e.push(t),this}}}(moment);
